<div class="active-phonecalls">

    <!-- Active phone calls -->
    <h2 class="heading">{{'ViewPhoneLog.Pending'|translate}}</h2>
    <div *ngIf="(!logs) || (logs.length === 0)">
        {{'ViewPhoneLog.Everything'|translate}}
    </div>
    <mat-card *ngFor="let log of ((logs | search:'urgent':query) | orderBy: sortProperty: reverse)">
        <div *ngIf="editingLog != log">
            <mat-card-content>
                <div class="caller">
                    <div *ngIf="log.name && log.name !== '' " class="naming caller-name">
                        {{log.name}}
                    </div>
                    <div *ngIf="log.pronouns && log.pronouns !== '' " class="caller-pronouns">
                        ( {{log.pronouns}} )
                    </div>
                </div>
                <div *ngIf="log.callertype && log.callertype !== '' " class="caller-type">
                    <div class="label">{{'ViewPhoneLog.Type'|translate}}</div>{{log.callertype}}
                </div>
                <div *ngIf="log.phonenumber !== '' " class="caller-phone">
                    <div class="label">{{'ViewPhoneLog.Phone'|translate}}</div>{{log.phonenumber}}
                </div>
                <div *ngIf="log.date && log.date !== '' " class="caller-date">
                    <div class="label">{{'ViewPhoneLog.Date'|translate}}</div>{{log.date| date : format : timezone}}
                </div>
                <div class="caller-heading">
                    <div *ngIf="log.subject && log.subject !== '' " class="caller-subject">
                        <div class="label">{{'ViewPhoneLog.Subject'|translate}}</div>{{log.subject}}
                    </div>
                    <div *ngIf="log.urgent && log.urgent == true " class="urgency warning-font">
                        {{'ViewPhoneLog.Urgent'|translate}}
                        <mat-icon color="warn">assignment_late</mat-icon>
                    </div>
                </div>
                <div *ngIf="log.message && log.message !== '' " class="message">
                    <div class="label">{{'ViewPhoneLog.Message'|translate}}</div>
                    <div class="call-text">{{log.message}}</div>
                </div>
                <div *ngIf="log.notes && log.notes[0] && log.notes[0] !== '' " class="note">
                    <div class="label">{{'ViewPhoneLog.Note'|translate}}</div>
                    <div class="call-text">{{log.notes[0]}}</div>
                </div>
                <div *ngIf="log.language && log.language !== '' " class="caller-language">
                    <div class="label">{{'ViewPhoneLog.Language'|translate}}</div>{{log.language}}
                </div>
                <div class="logger">
                    <div class="label">{{'ViewPhoneLog.LoggedBy'|translate}}</div> {{log.user.name}}
                </div>

            </mat-card-content>
            <mat-card-actions class="phonecall-actions">
                <button mat-raised-button (click)="resolve(log)" color="primary">
                    <mat-icon>check_circle</mat-icon>
                    {{'ViewPhoneLog.Resolve'|translate}}
                </button>
                <button mat-icon-button (click)="edit(log)" color="primary">
                    <mat-icon>edit</mat-icon>
                </button>
                <button mat-icon-button color="warn" (click)="delete(log)">
                    <mat-icon>delete_forever</mat-icon>
                </button>
            </mat-card-actions>
        </div>
        <div *ngIf="editingLog == log">
            <app-edit-phonelog [log]="editingLog" (cancel)="cancel()"></app-edit-phonelog>
        </div>
    </mat-card>
</div>

<!-- History -->
<div class="past-phonecalls">
    <h2 class="heading">{{'ViewPhoneLog.Completed'|translate}}</h2>
    <div *ngIf="(!history) || (history.length === 0)">
        {{'ViewPhoneLog.Nothing'|translate}}
    </div>

    <mat-accordion *ngIf="history && history.length > 0">
        <mat-expansion-panel *ngFor="let log of ((history | search:'urgent':query) | orderBy: sortProperty: reverse)">

            <!-- Panel Header -->
            <mat-expansion-panel-header>
                <mat-panel-title class="title">
                    {{log.name}}
                </mat-panel-title>
                <mat-panel-description>
                   {{'ViewPhoneLog.Date'|translate}} {{log.date| date : format : timezone}}
                </mat-panel-description>
            </mat-expansion-panel-header>


            <div class="history-container">
                <div class="history-content">
                    <div *ngIf="log.name && log.name !== ''">
                        <b> {{'ViewPhoneLog.Name'|translate}} </b> {{log.name}}
                        <br>
                    </div>
                    <div *ngIf="log.pronouns && log.pronouns !== '' ">
                        <b> {{'ViewPhoneLog.Pronouns'|translate}} </b> {{log.pronouns}}
                        <br>
                    </div>
                    <div *ngIf="log.callertype && log.callertype !== '' ">
                        <b> {{'ViewPhoneLog.Type'|translate}} </b> {{log.callertype}}
                        <br>
                    </div>
                    <div *ngIf="log.phonenumber && log.phonenumber !== '' ">
                        <b> {{'ViewPhoneLog.Phone'|translate}} </b> {{log.phonenumber}}
                        <br>
                    </div>
                    <div *ngIf="log.subject && log.subject !== '' ">
                        <b> {{'ViewPhoneLog.Subject'|translate}} </b> {{log.subject}}
                        <br>
                    </div>
                    <div *ngIf="log.urgent && log.urgent == true ">
                        <b> Urgent: </b>Yes
                        <br>
                    </div>
                    <div *ngIf="log.urgent && log.urgent == false ">
                        <b> {{'ViewPhoneLog.Urgent'|translate}} </b> No
                        <br>
                    </div>
                    <div *ngIf="log.date && log.date !== '' ">
                        <b> {{'ViewPhoneLog.Date'|translate}} </b> {{log.date| date : format : timezone}}
                        <br>
                    </div>
                    <div *ngIf="log.language && log.language !== '' ">
                        <b> {{'ViewPhoneLog.Language'|translate}} </b>{{log.language}}
                        <br>
                    </div>
                    <div *ngIf="log.message && log.message !== '' ">
                        <b> {{'ViewPhoneLog.Message'|translate}} </b> {{log.message}}
                        <br>
                    </div>
                    <div *ngIf="log.notes[0] && log.notes[0] !=='' ">
                        <b> {{'ViewPhoneLog.Note'|translate}} </b> {{log.notes[0]}}
                        <br>
                    </div>
                    <div>
                        <b> {{'ViewPhoneLog.LoggedBy'|translate}} </b> {{log.user.name}}
                        <br>
                    </div>
                    <div>
                        <b> {{'ViewPhoneLog.CalledBy'|translate}} </b> {{log.resolvedBy.name}}
                        <br>
                    </div>
                    <div>
                        <b> {{'ViewPhoneLog.DateCalledBy'|translate}} </b> {{log.dateResolved | date : format : timezone}}
                        <br>
                    </div>
                </div>

                <div class="history-action">
                    <button mat-icon-button (click)="delete(log)">
                            <mat-icon color="warn">delete</mat-icon>    
                    </button>
                </div>
            </div>

        </mat-expansion-panel>

    </mat-accordion>
</div>